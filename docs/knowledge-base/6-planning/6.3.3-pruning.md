# 6.3.3 Pruning (Dead Ends)

## TL;DR

Pruning eliminates unpromising branches early in tree search, reducing computation by 60-80% while maintaining solution quality—using score thresholds, depth limits, and dead-end detection to focus resources on viable paths.

- **Status**: ✅ Complete
- **Last Updated**: 2025-12-12
- **Prerequisites**: [6.3.1 Multi-Path Exploration](./6.3.1-multi-path.md), [6.3.2 Branching](./6.3.2-branching.md)
- **Grounded In**: Alpha-Beta Pruning, Tree of Thoughts (2023), Search Optimization

## Overview

Pruning is the selective elimination of branches during tree search. Without pruning, exploration grows exponentially. Effective pruning maintains solution quality while dramatically reducing compute.

**Impact**: 60-80% reduction in nodes explored with <5% solution quality loss.

**Date Verified**: 2025-12-12

## Pruning Strategies

### Score-Based Pruning

```typescript
const SCORE_THRESHOLD = 0.2;

function shouldPrune(node: ThoughtNode): boolean {
  // Prune if score below threshold
  if (node.score < SCORE_THRESHOLD) return true;

  // Prune if much worse than siblings
  const siblingScores = node.parent?.children.map(c => c.score) ?? [];
  const maxSibling = Math.max(...siblingScores);
  if (node.score < maxSibling * 0.5) return true;

  return false;
}
```

### Depth-Limited Pruning

```typescript
const MAX_DEPTH = 5;

function depthPrune(node: ThoughtNode): boolean {
  return node.depth >= MAX_DEPTH;
}
```

### Dead-End Detection

```typescript
async function isDeadEnd(state: string): Promise<boolean> {
  const { object } = await generateObject({
    model: openai('gpt-4o-mini'),
    schema: z.object({
      isDeadEnd: z.boolean(),
      reason: z.string(),
    }),
    prompt: `Is this state a dead end with no path to solution?
State: ${state}`,
  });
  return object.isDeadEnd;
}
```

### Beam Pruning

```typescript
function beamPrune(
  nodes: ThoughtNode[],
  beamWidth: number = 5
): ThoughtNode[] {
  // Keep only top-K nodes at each level
  return nodes
    .sort((a, b) => b.score - a.score)
    .slice(0, beamWidth);
}
```

## Pruning Configuration

| Strategy | Aggression | Quality Impact | Cost Savings |
|----------|------------|----------------|--------------|
| Conservative | Low | <1% | 30-40% |
| Moderate | Medium | 2-3% | 50-60% |
| Aggressive | High | 5-10% | 70-80% |

## Key Takeaways

1. **Prune early**: Eliminating nodes early saves exponential work
2. **Score threshold 0.2-0.3**: Good default for most tasks
3. **Beam search**: Simple and effective for many problems
4. **Dead-end detection**: Worth the extra LLM call for complex domains

## References

1. **Yao et al.** (2023). "Tree of Thoughts". NeurIPS 2023.
2. **Russell & Norvig** (2020). "Artificial Intelligence: A Modern Approach".

**Related Topics**: [6.3.2 Branching](./6.3.2-branching.md), [6.3.4 Best-First](./6.3.4-best-first.md)

**Layer Index**: [Layer 6: Planning & Orchestration](../AI_KNOWLEDGE_BASE_TOC.md#layer-6-planning--orchestration)
