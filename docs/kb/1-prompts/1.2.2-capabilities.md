# 1.2.2 System Prompts: Capabilities Declaration

## Overview

Capabilities declaration explicitly tells the AI what it CAN do—the tools, knowledge, skills, and resources available to accomplish tasks. Clear capability statements prevent confusion, reduce errors, and help the AI make better decisions about which tools to use and when.

**Key Principle**: If the AI knows what it can do, it won't try to do what it can't.

**Current Date**: November 2025

## Why Declare Capabilities

### Problem: Implicit Capabilities Lead to Errors

**Without explicit declaration**:
```
User: "Send an email to john@example.com"
AI: "I'll send that email now..."
Result: ❌ Failure - AI has no email tool, hallucinates success
```

**With explicit declaration**:
```
System Prompt:
"You have access to these tools:
- cms_getPage: Retrieve page content
- cms_createPage: Create new pages
(You cannot send emails, access external APIs, or browse the web)"

User: "Send an email to john@example.com"
AI: "I don't have email capabilities. I can help with content management tasks like creating pages or retrieving content. Would you like me to do something else?"
Result: ✅ Honest response, user redirected
```

### Benefits of Explicit Capabilities

**1. Prevents Hallucination**
- AI won't claim to do things it can't
- Users get honest "I can't do that" responses
- Trust increases

**2. Improves Tool Selection**
- AI knows full tool inventory
- Makes informed decisions about which tool to use
- Reduces trial-and-error

**3. Sets User Expectations**
- Users know what's possible
- Fewer frustrated requests
- Better UX

**4. Enables Self-Diagnosis**
- AI can suggest alternatives when capability missing
- Helps users rephrase requests to match capabilities

## Capabilities Declaration Patterns

### Pattern 1: Tool Inventory

**Simple List**:
```
You have access to these tools:
- cms_getPage: Retrieve page by ID or slug
- cms_createPage: Create new page with sections
- cms_deletePage: Delete a page (requires confirmation)
- cms_addSection: Add section to existing page
- cms_updateContent: Modify section content
```

**Structured with Categories**:
```
You have access to these content management tools:

Page Operations:
- cms_getPage(pageId): Get page metadata and content
- cms_createPage(name, slug): Create new page
- cms_deletePage(pageId): Delete page (destructive)

Section Operations:
- cms_addSection(pageId, sectionDefId): Add section to page
- cms_updateSection(sectionId, content): Update section content
- cms_deleteSection(sectionId): Remove section from page

Search Operations:
- cms_findResource(query, type): Fuzzy search for pages/sections
```

**With Usage Guidance**:
```
Available Tools:

cms_getPage(slug):
- Purpose: Retrieve page information
- When to use: User asks about specific page
- Returns: Page metadata + section IDs
- Note: Use cms_getSectionContent() for actual section content

cms_getSectionContent(sectionId):
- Purpose: Get content from specific section
- When to use: Need section details after getting page
- Returns: Full section content with all fields
- Note: More efficient than including content in getPage
```

### Pattern 2: Knowledge Domains

```
Your knowledge includes:

Content Management:
- Creating, reading, updating, deleting pages
- Section definitions and schemas
- Content modeling best practices

Web Development:
- HTML, CSS, JavaScript fundamentals
- React patterns and best practices
- TypeScript type systems

You do NOT have access to:
- Real-time data (stock prices, weather, news)
- User authentication systems
- External APIs or databases
- File system access beyond the CMS
```

### Pattern 3: Capability Matrix

```
| Capability | Available | Details |
|------------|-----------|---------|
| Read pages | ✅ Yes | Via cms_getPage |
| Create pages | ✅ Yes | Via cms_createPage |
| Delete pages | ✅ Yes | Requires user confirmation |
| Send emails | ❌ No | Not available in this system |
| Access database | ❌ No | All data via CMS API only |
| Browse web | ❌ No | No external internet access |
```

### Pattern 4: Conditional Capabilities

```
Your capabilities depend on context:

When working with pages:
- You CAN: Read, create, update, delete
- You CAN: Add/remove sections
- You CAN: Update section content

When user mentions "this page":
- Check working memory for recently accessed page
- If found, you CAN operate on it directly
- If not found, you MUST search for it first

When deleting:
- You MUST get user confirmation
- You CAN show what will be deleted before confirming
- You CANNOT auto-confirm destructive operations
```

## Your Codebase Example

**From `server/prompts/react.xml`**:

```xml
**AVAILABLE TOOLS:** {{toolCount}} tools

{{toolsFormatted}}
```

**Analysis**:
✅ **Dynamic tool list**: Auto-populated from actual tools
✅ **Count provided**: User knows scope
✅ **Formatted output**: Structured, easy to parse

**Current approach** (implicit from examples):
```xml
**EXAMPLE SESSION:**
User: "Add a hero section to the about page"
Thought: I need to find the about page first using fuzzy search.
Action: cms_findResource
```

**Shows capabilities through examples** (learning by demonstration)

**Enhancement Opportunity**:

**Add explicit capabilities section**:
```xml
**YOUR CAPABILITIES:**

Content Management:
- Search for resources (pages, sections, collections) using fuzzy matching
- Retrieve pages with optional content inclusion (token-efficient)
- Create, update, and delete pages and sections
- Manage collections and entries
- Add/remove media attachments

Token Optimization:
- Granular fetching: Get metadata first, content only when needed
- Saves 40-96% tokens vs full fetch
- Smart caching of working memory

Workflow Intelligence:
- Multi-step task planning and execution
- Error recovery and retries
- Confirmation for destructive operations
- Context resolution (understands "this page", "that section")

Limitations:
- Cannot access external APIs or databases
- Cannot send emails or notifications
- Cannot execute arbitrary code
- Cannot access file system outside CMS

**AVAILABLE TOOLS:** {{toolCount}} tools
{{toolsFormatted}}
```

## Advanced Patterns

### 1. Hierarchical Capabilities

```
Your core capabilities (always available):
├── Content Management (10 tools)
│   ├── Pages: create, read, update, delete, search
│   ├── Sections: add, remove, update, reorder
│   └── Collections: manage entries and relationships
├── Search & Discovery (3 tools)
│   ├── Fuzzy resource search across all types
│   ├── Content search within pages
│   └── Tag-based filtering
└── Utility (2 tools)
    ├── Working memory access (recent resources)
    └── Schema inspection (section definitions)

Extended capabilities (context-dependent):
├── Batch operations (when multiple items selected)
├── Content preview (when draft mode enabled)
└── Rollback (when versioning enabled)
```

### 2. Capability Prerequisites

```
Tool dependencies and prerequisites:

To delete a section:
1. First verify: You MUST have the section ID
2. Check: Is this a destructive operation? (Yes - needs confirmation)
3. Execute: Call cms_deleteSection with confirmed flag
4. Verify: Check response for success

To create a page with sections:
1. Required: page name and slug
2. Optional: section definitions to add
3. Process:
   a) Create page first (get pageId)
   b) For each section: get section def ID
   c) Add sections to page
   d) Populate content
4. Return: Complete page with all sections added
```

### 3. Dynamic Capability Discovery

```
Your capabilities are dynamic and context-aware:

At runtime, you can:
- Query available tools: Check {{toolCount}} and {{toolsFormatted}}
- Inspect tool schemas: Understand parameters and return types
- Check working memory: See what resources are recently loaded
- Verify permissions: Some operations require user confirmation

If you're unsure whether you can do something:
1. Check your tool list
2. Look for similar capabilities
3. Explain what you CAN do that's closest
4. Ask user if alternative approach works
```

### 4. Capability-Driven Planning

```
When planning multi-step tasks:

1. Capability Check:
   - List all required capabilities
   - Verify each is available
   - Identify gaps or missing tools

2. Fallback Planning:
   - If capability missing, suggest workaround
   - Explain why direct approach isn't possible
   - Offer manual steps user could take

3. Execution:
   - Use only declared capabilities
   - Never assume abilities not listed
   - Document which capabilities were used
```

## Integration with Tool Metadata

### Tool Definition Structure

```typescript
// Example tool metadata structure
interface ToolMetadata {
  name: string;
  description: string;
  category: 'pages' | 'sections' | 'collections' | 'search';
  requiresConfirmation?: boolean;
  parameters: {
    name: string;
    type: string;
    required: boolean;
    description: string;
  }[];
  returns: string;
  examples?: string[];
}

// Your codebase pattern
export const TOOL_METADATA: Record<string, ToolMetadata> = {
  cms_getPage: {
    name: 'cms_getPage',
    description: 'Retrieve page by ID or slug',
    category: 'pages',
    parameters: [/*...*/],
    returns: 'Page with metadata and section IDs',
    examples: ['Get page by slug: cms_getPage({slug: "about"})']
  },
  // ... more tools
};
```

### Auto-Generating Capabilities

```typescript
// Generate capability declaration from tool registry
function generateCapabilitiesPrompt(tools: Record<string, ToolMetadata>): string {
  const byCategory = groupBy(tools, t => t.category);
  
  let prompt = "**YOUR CAPABILITIES:**\n\n";
  
  for (const [category, categoryTools] of Object.entries(byCategory)) {
    prompt += `${capitalize(category)} Operations:\n`;
    
    for (const tool of categoryTools) {
      const conf = tool.requiresConfirmation ? ' (requires confirmation)' : '';
      prompt += `- ${tool.name}: ${tool.description}${conf}\n`;
    }
    prompt += '\n';
  }
  
  return prompt;
}
```

**Benefit**: Capabilities auto-update when tools change.

## Capability Boundaries & Limitations

### Explicit "Cannot Do" List

```
What you CANNOT do:

External Access:
- Cannot browse the internet or access external APIs
- Cannot send emails, SMS, or push notifications
- Cannot make HTTP requests to external services

System Access:
- Cannot access file system outside CMS
- Cannot execute shell commands
- Cannot modify database directly

User Data:
- Cannot access user authentication or passwords
- Cannot view audit logs or system logs
- Cannot impersonate users

Time-Based:
- Cannot schedule future operations
- Cannot set up webhooks or triggers
- Cannot run background jobs

If user requests any of these, explain the limitation and suggest alternatives within your capabilities.
```

### Graceful Degradation

```
When you lack a capability:

1. Acknowledge honestly:
   "I don't have the ability to [requested action]."

2. Explain why:
   "This system doesn't have email integration configured."

3. Suggest alternatives:
   "I can help you:
   - Create a page with the email content you'd send
   - Generate the email text for you to copy
   - Add a contact form to your website"

4. Stay helpful:
   "What would you like me to do instead?"
```

## Testing Capabilities Declaration

### The 3-Question Test

**1. Capability Inventory**:
```
User: "What can you help me with?"
Expected: Clear list of capabilities by category

Good: "I can help with content management: creating pages, managing sections, searching content..."
Bad: "I can help with many things!" (vague)
```

**2. Boundary Recognition**:
```
User: "Can you send an email to our subscribers?"
Expected: Honest "no" with explanation

Good: "I don't have email capabilities. I'm focused on content management. I can help create email content or add contact forms to your site."
Bad: "Sure, I'll send that email!" (hallucination)
```

**3. Alternative Suggestion**:
```
User: "Schedule this page to publish next Monday"
Expected: Explain limitation + suggest workaround

Good: "I can't schedule future publishes (no scheduling system), but I can:
- Create the page now as draft
- Add a note about publish date
- Show you how to manually publish it Monday
Which would help?"
Bad: "Okay, scheduled!" (false claim)
```

## Real-World Examples

### Example 1: Documentation Generator

```
**YOUR CAPABILITIES:**

Documentation Creation:
- Generate API documentation from TypeScript interfaces
- Create markdown files with proper formatting
- Add code examples and usage guides
- Generate table of contents

Code Analysis:
- Parse TypeScript, JavaScript files
- Extract types, interfaces, function signatures
- Identify JSDoc comments and annotations

What I CANNOT do:
- Run or execute code
- Access private repositories without permission
- Generate documentation for binary files
- Create visual diagrams (I can describe them)

When you ask me to document code:
1. I'll analyze the source files provided
2. Extract relevant information (types, functions, comments)
3. Generate structured markdown documentation
4. Include usage examples based on code patterns
```

### Example 2: Customer Support Bot

```
**MY CAPABILITIES:**

I can help you with:

Order Management:
- Check order status (need order number)
- Provide tracking information
- Explain shipping timelines

Product Information:
- Answer questions about products in our catalog
- Compare product features
- Check current pricing and availability

Returns & Refunds:
- Explain our 30-day return policy
- Guide you through return process
- Check refund status

I CANNOT:
- Process refunds directly (I'll create a ticket for our team)
- Access your account password or payment info
- Modify orders already shipped
- Make policy exceptions (escalate to supervisor)

For any of these, I'll escalate to a human agent who can help immediately.
```

### Example 3: Code Review Bot

```
**REVIEW CAPABILITIES:**

I can analyze:
- TypeScript, JavaScript, React code
- HTML, CSS, Tailwind classes
- SQL queries
- Configuration files (tsconfig, package.json)

I check for:
✅ Correctness (bugs, logic errors)
✅ Security (XSS, SQL injection, auth issues)
✅ Performance (N+1 queries, unnecessary re-renders)
✅ Best practices (React patterns, TypeScript usage)
✅ Code style (naming, structure)

I provide:
- Specific issue locations (file:line)
- Severity ratings (critical/major/minor)
- Fix suggestions with code examples
- Explanations of why issues matter

I do NOT:
❌ Run or execute code
❌ Access production systems
❌ Make changes directly (I only suggest)
❌ Review binary files or images
❌ Guarantee 100% bug detection (use testing + human review)
```

## Key Takeaways

**What is Capabilities Declaration**:
- Explicit statement of what AI can and cannot do
- Lists tools, knowledge domains, and limitations
- Prevents hallucination and sets expectations

**Why It Matters**:
- Prevents AI from claiming false abilities
- Improves tool selection and planning
- Sets clear user expectations
- Enables graceful degradation

**Capabilities Patterns**:
1. **Tool Inventory**: List available tools with descriptions
2. **Knowledge Domains**: Areas of expertise
3. **Capability Matrix**: Table of can/cannot
4. **Conditional Capabilities**: Context-dependent abilities

**Your Codebase**:
- Currently uses dynamic tool list (`{{toolsFormatted}}`)
- Shows capabilities through examples
- Could add explicit capabilities section
- Auto-generation from tool metadata is ideal

**Best Practices**:
- Be explicit about what you CAN do
- Be honest about what you CANNOT do
- Suggest alternatives when lacking capability
- Update capabilities when tools change
- Test with boundary cases

**Integration**:
```typescript
// Auto-generate from tool registry
const capabilities = generateCapabilitiesPrompt(TOOL_METADATA);

// Include in system prompt
const systemPrompt = `
You are an autonomous AI assistant.

${capabilities}

{{toolsFormatted}}
`;
```

**Testing**:
1. Inventory test: "What can you do?"
2. Boundary test: Ask for unavailable capability
3. Alternative test: Check suggestions when limited

## Practical Exercise

Create capabilities declarations for:

**Exercise 1**: Your CMS Agent
```
List all current capabilities from your tool registry.
Organize by category (pages, sections, search, etc.).
Add explicit "cannot do" section.
```

**Exercise 2**: Email Marketing Bot
```
Define capabilities for an AI that:
- Has access to: email templates, subscriber lists, analytics
- Does NOT have: billing, account management, content creation
```

**Exercise 3**: Enhancement
```
Take your current ReAct prompt and add:
- Structured capabilities declaration
- Clear boundaries and limitations
- Alternative suggestions pattern
```

## Navigation

- [← Previous: 1.2.1 Role Definition](./1.2.1-role-definition.md)
- [↑ Back to Knowledge Base TOC](../../AI_KNOWLEDGE_BASE_TOC.md)
- [→ Next: 1.2.3 Rules & Constraints](./1.2.3-rules-constraints.md)

---

*Part of Layer 1: Prompt Engineering - Declaring what AI can and cannot do*
