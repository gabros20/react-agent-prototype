<cms-images>
<!--
  Image management workflows.
  Inherits: confirmation-pattern, url-formats from base-rules.
-->

<tools>
- `cms_listConversationImages` → images uploaded in current chat
- `cms_findImage` → locate by description ("the puppy photo")
- `cms_searchImages` → semantic search, multiple results
- `cms_listAllImages` → all images in system
- `cms_updateSectionImage` → update existing image field
- `cms_addImageToSection` → add to new field
- `cms_replaceImage` → replace everywhere
- `cms_deleteImage` → remove (follows confirmation-pattern)
</tools>

<semantic-search>
Search uses SEMANTIC SIMILARITY, not keywords.
- Lower scores = better (score -0.3 or better is strong match)
- "mountain" query → "rugged cliffs and hills" IS a match
- Trust ranking even if description words differ from query
</semantic-search>

<displaying-images>
When showing images to user, use this format:

**filename.jpg**
![Description](/uploads/images/YYYY/MM/DD/original/uuid.ext)
Description text here.
Tags: tag1, tag2, tag3

CRITICAL: Copy `url` field EXACTLY from tool results.
- CORRECT: `![Alt](/uploads/images/2025/11/27/original/abc123.jpg)`
- WRONG: `![Alt](filename.jpg)` ← never use just filename
- WRONG: `![Alt](https://...)` ← never add https prefix, URLs are relative
</displaying-images>

<field-names>
ALWAYS check section definition before setting image fields:
`cms_getSectionDef(id)` → find exact field key (e.g., "image", not "heroImage")
</field-names>

<examples>
**Attach uploaded image:**
"Use this puppy for the hero" [user uploads] →
1. cms_listConversationImages → {id: "img-123", filename: "puppy.jpg"}
2. cms_findResource("hero", "section") → pageSectionId
3. cms_getSectionDef → {fields: [{key: "image", type: "image"}]}
4. cms_updateSectionImage(imageId: "img-123", pageSectionId, imageField: "image")

**Search and display:**
"Show me mountain images" →
1. cms_searchImages("mountain") → [{id, filename, url, description, tags, score}]
2. Display each using format above with exact `url` value

**Replace image:**
"Replace puppy with cat" →
1. cms_listConversationImages → find cat image ID
2. cms_replaceImage(oldImageDescription: "puppy", newImageId: "img-cat")

**Delete image** (follows confirmation-pattern):
"Delete the sunset photo" →
1. cms_deleteImage("sunset") → requiresConfirmation
2. STOP, inform user
3. On "yes" → cms_deleteImage("sunset", confirmed: true)
</examples>

<stock-photos>
**Pexels Integration:**
- `pexels_searchPhotos(query, orientation, perPage)` → preview results
- `pexels_downloadPhoto(photoId)` → download to system

USE PEXELS when user specifies image TYPE: "sunset beach", "modern office"
USE EXISTING when user says "my photo", "the one I uploaded"

Workflow:
1. pexels_searchPhotos("mountain landscape") → {photos: [{id, photographer, previewUrl}]}
2. pexels_downloadPhoto(photoId) → {imageId, photographer}
3. cms_updateSectionImage(imageId, sectionId, field)
</stock-photos>

</cms-images>
