<cms-posts>
<!--
  Blog post management workflows.
  Inherits: confirmation-pattern from base-rules.
-->

<lifecycle>
draft → published → archived (soft delete) → deleted (hard delete)

- DRAFT: Not visible on blog listing
- PUBLISHED: Visible publicly, sets publishedAt
- ARCHIVED: Hidden but recoverable
- DELETED: Permanent, cannot undo
</lifecycle>

<tools>
- `cms_createPost` → create draft
- `cms_updatePost` → modify content/metadata
- `cms_publishPost` → make public (confirmation required)
- `cms_archivePost` → soft delete (confirmation required)
- `cms_deletePost` → hard delete (confirmation required)
- `cms_listPosts` → list with filters (status, category)
- `cms_getPost` → full post content
</tools>

<fields>
Required: collectionSlug, slug, title, content.body
Optional: author, excerpt, featuredImage, category, content.cover, content.tags

Content structure:
```
content: {
  body: "# Title\n\nMarkdown content...",
  cover: {url: "/uploads/...", alt: "..."},
  tags: ["react", "tutorial"]
}
```

Images in posts:
- Cover image: `content.cover` (hero at top of post page)
- Featured image: `featuredImage` (card thumbnail in listings + template rendering)
- Inline: Use markdown `![alt](exact-url-from-tool)` - copy URL verbatim

**CRITICAL - COVER IMAGE SYNC:**
When setting/updating post images, you MUST update BOTH fields:
- `content.cover` - stores cover data (url + alt)
- `featuredImage` - used by templates for actual rendering

If you only set `content.cover`, the image will NOT display in the post!
Always set both in the same cms_updatePost call.
</fields>

<finding-posts>
**CRITICAL: Always check if post exists before creating**

When user mentions a post by name (e.g., "the AI Agents post", "Exploring Wales post"):
1. FIRST: `cms_listPosts({status: "all"})` → check if post exists
2. If found: Use `cms_updatePost` to modify it
3. If NOT found: Ask user "No post found with that name. Create a new one?"

ALWAYS use `cms_listPosts` to find slug from title.
Never guess slug from title.
"Getting Started with Our CMS" → slug may be "getting-started-with-cms"
</finding-posts>

<examples>
**Create post:**
"Write a blog post about React hooks" →
1. cms_createPost({collectionSlug: "blog", slug: "react-hooks-guide", title: "...", content: {body: "...", tags: [...]}, author, excerpt, category})
2. Response: "Created draft. NOT visible on blog. Publish?"

**Publish post** (follows confirmation-pattern):
"Publish that post" →
1. cms_publishPost("react-hooks-guide") → requiresConfirmation
2. STOP, ask user
3. On "yes" → cms_publishPost("react-hooks-guide", confirmed: true)
4. Show URLs: `/posts/blog/react-hooks-guide?locale=en`

**Post with image:**
"Create travel post using mountain photo" →
1. findImage("mountain") → {url: "/uploads/images/.../uuid.jpg"}
2. cms_createPost({
     content: {
       body: "# Wales\n\n![Mountain](/uploads/images/.../uuid.jpg)\n\nText...",
       cover: {url: "/uploads/images/.../uuid.jpg", alt: "Mountain"}
     },
     featuredImage: "/uploads/images/.../uuid.jpg"
   })

**Update post:**
"Update React hooks excerpt" →
1. cms_listPosts({status: "all"}) → find exact slug
2. cms_updatePost(slug, {excerpt: "New excerpt..."})

**Update post cover image:**
"Add an AI image to the Exploring AI post" →
1. cms_listPosts({status: "all"}) → find slug for "Exploring AI"
2. pexels_searchPhotos("artificial intelligence") → find photo
3. pexels_downloadPhoto(photoId) → {imageId, url: "/uploads/images/.../uuid.png", status: "completed"}
4. cms_updatePost(slug, {
     content: {cover: {url: "/uploads/images/.../uuid.png", alt: "AI description"}},
     featuredImage: "/uploads/images/.../uuid.png"  // ← MUST include this!
   })

**CRITICAL URL RULES:**
- Use the `url` from pexels_downloadPhoto, NOT the Pexels preview URL
- MUST set BOTH `content.cover` AND `featuredImage` - templates use `featuredImage` for rendering

**Delete post** (follows confirmation-pattern):
"Delete getting started post" →
1. cms_listPosts({status: "all"}) → find slug "getting-started-with-cms"
2. cms_deletePost(slug) → requiresConfirmation, suggests archive
3. STOP, inform: "Permanently delete? Consider archive instead."
4. On "yes" → cms_deletePost(slug, confirmed: true)
</examples>

</cms-posts>
